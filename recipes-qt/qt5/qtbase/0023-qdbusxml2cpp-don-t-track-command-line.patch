From 0b76b109695081d1de19a90117c1d22f5abcd4cc Mon Sep 17 00:00:00 2001
From: Samuli Piippo <samuli.piippo@qt.io>
Date: Wed, 24 Apr 2024 13:50:31 +0000
Subject: [PATCH] qdbusxml2cpp: don't track command line
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Generate source code without information about original location of the
source file. Useful for reproducible builds.

Task-number: QTBUG-105926
Task-number: QTBUG-105913
Change-Id: I33b24e11773c8ad3489cc84df3c42b43a6116378
Reviewed-by: Thiago Macieira <thiago.macieira@intel.com>
Reviewed-by: Kai KÃ¶hne <kai.koehne@qt.io>
Reviewed-by: Ari Parkkila <ari.parkkila@qt.io>

Upstream-Status: Backport

Fixes:
ERROR: QA Issue: File /usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/compass_interface.h in package qtsensors-src contains reference to TMPDIR [buildpaths]
ERROR: QA Issue: File /usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/sensorproxy_interface.h in package qtsensors-src contains reference to TMPDIR [buildpaths]
ERROR: QA Issue: File /usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/properties_interface.cpp in package qtsensors-src contains reference to TMPDIR [buildpaths]
ERROR: QA Issue: File /usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/properties_interface.h in package qtsensors-src contains reference to TMPDIR [buildpaths]
ERROR: QA Issue: File /usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/sensorproxy_interface.cpp in package qtsensors-src contains reference to TMPDIR [buildpaths]
ERROR: QA Issue: File /usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/compass_interface.cpp in package qtsensors-src contains reference to TMPDIR [buildpaths]

caused by this:

./qtsensors-src/usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/compass_interface.h: * Command line was: qdbusxml2cpp -N -p compass_interface.h: /OE/build/test-oe-build-time/poky/build/tmp/work/core2-64-poky-linux/qtsensors/5.15.16+git/git/src/plugins/sensors/iio-sensor-proxy/net.hadess.SensorProxy.Compass.xml
./qtsensors-src/usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/sensorproxy_interface.h: * Command line was: qdbusxml2cpp -N -p sensorproxy_interface.h: /OE/build/test-oe-build-time/poky/build/tmp/work/core2-64-poky-linux/qtsensors/5.15.16+git/git/src/plugins/sensors/iio-sensor-proxy/net.hadess.SensorProxy.xml
./qtsensors-src/usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/properties_interface.cpp: * Command line was: qdbusxml2cpp -i properties_interface.h -p :properties_interface.cpp /OE/build/test-oe-build-time/poky/build/tmp/work/core2-64-poky-linux/qtsensors/5.15.16+git/git/src/plugins/sensors/iio-sensor-proxy/org.freedesktop.DBus.Properties.xml
./qtsensors-src/usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/properties_interface.h: * Command line was: qdbusxml2cpp -N -p properties_interface.h: /OE/build/test-oe-build-time/poky/build/tmp/work/core2-64-poky-linux/qtsensors/5.15.16+git/git/src/plugins/sensors/iio-sensor-proxy/org.freedesktop.DBus.Properties.xml
./qtsensors-src/usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/sensorproxy_interface.cpp: * Command line was: qdbusxml2cpp -i sensorproxy_interface.h -p :sensorproxy_interface.cpp /OE/build/test-oe-build-time/poky/build/tmp/work/core2-64-poky-linux/qtsensors/5.15.16+git/git/src/plugins/sensors/iio-sensor-proxy/net.hadess.SensorProxy.xml
./qtsensors-src/usr/src/debug/qtsensors/5.15.16+git/src/plugins/sensors/iio-sensor-proxy/compass_interface.cpp: * Command line was: qdbusxml2cpp -i compass_interface.h -p :compass_interface.cpp /OE/build/test-oe-build-time/poky/build/tmp/work/core2-64-poky-linux/qtsensors/5.15.16+git/git/src/plugins/sensors/iio-sensor-proxy/net.hadess.SensorProxy.Compass.xml
---
 src/tools/qdbusxml2cpp/qdbusxml2cpp.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/tools/qdbusxml2cpp/qdbusxml2cpp.cpp b/src/tools/qdbusxml2cpp/qdbusxml2cpp.cpp
index 9825596f3d9..30917036102 100644
--- a/src/tools/qdbusxml2cpp/qdbusxml2cpp.cpp
+++ b/src/tools/qdbusxml2cpp/qdbusxml2cpp.cpp
@@ -163,7 +163,7 @@ static QTextStream &writeHeader(QTextStream &ts, bool changesWillBeLost)
 {
     ts << "/*" << Qt::endl
        << " * This file was generated by " PROGRAMNAME " version " PROGRAMVERSION << Qt::endl
-       << " * Command line was: " << commandLine << Qt::endl
+       << " * Source file was: " << QFileInfo(inputFile).fileName() << Qt::endl
        << " *" << Qt::endl
        << " * " PROGRAMNAME " is " PROGRAMCOPYRIGHT << Qt::endl
        << " *" << Qt::endl
